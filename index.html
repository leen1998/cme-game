<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Case of the Misleading Metrics: CME Detective Agency</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Plus+Jakarta+Sans:wght@700;800&family=Crimson+Pro:italic,wght@600&display=swap');

        :root {
            --slate-900: #0f172a;
            --teal-600: #0d9488;
            --teal-50: #f0fdfa;
            --indigo-600: #4f46e5;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: #f1f5f9;
            color: var(--slate-900);
            overflow-x: hidden;
        }

        .heading { font-family: 'Plus Jakarta Sans', sans-serif; }
        .serif { font-family: 'Crimson Pro', serif; }

        .game-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 1.5rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }

        .btn-teal {
            background-color: var(--teal-600);
            color: white;
            box-shadow: 0 4px 6px -1px rgba(13, 148, 136, 0.2);
        }
        .btn-teal:hover { background-color: #0f766e; transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(13, 148, 136, 0.3); }

        .npc-chat {
            background: var(--teal-50);
            border-left: 4px solid var(--teal-600);
            padding: 1.25rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1rem;
        }
        .npc-chat:hover { transform: translateX(5px); background: #e6fcf5; border-left-width: 8px; }

        .drop-zone {
            min-height: 140px;
            border: 2px dashed #cbd5e1;
            background: #f8fafc;
            border-radius: 1rem;
            padding: 1rem;
            transition: all 0.2s;
        }
        .drop-zone.active { border-color: var(--indigo-600); background: #eef2ff; }

        .evidence-token {
            background: white;
            padding: 0.85rem;
            border-radius: 0.75rem;
            border: 1px solid #e2e8f0;
            cursor: grab;
            font-size: 0.85rem;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .stage-hidden { display: none; }
        
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .animate-up { animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1); }

        textarea::placeholder { color: #94a3b8; font-style: italic; }

        .progress-step { width: 33.33%; height: 4px; transition: background 0.5s; }
        .progress-step.active { background: var(--teal-600); }
        .progress-step.inactive { background: #e2e8f0; }
    </style>
</head>
<body class="antialiased p-4 md:p-12">

    <div class="max-w-6xl mx-auto">
        <!-- HEADER -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-12 pb-6 border-b border-slate-200 gap-6">
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <i class="fa-solid fa-building-columns text-teal-600"></i>
                    <span class="text-[10px] font-black uppercase text-slate-400 tracking-[0.3em]">CME Intelligence Agency</span>
                </div>
                <h1 class="text-3xl font-extrabold heading text-slate-900 leading-none">The Case of the Misleading Metrics</h1>
                <p id="status-text" class="text-xs font-bold text-teal-600 mt-2">Current Mission: Secure Authorization</p>
            </div>
            
            <div class="flex flex-col items-end gap-3">
                <div id="session-timer" class="text-right hidden">
                    <span class="text-[10px] uppercase font-bold text-slate-400 block mb-1">Time to Debrief</span>
                    <div class="flex items-center gap-2 bg-slate-100 px-4 py-2 rounded-full border">
                        <i class="fa-solid fa-hourglass-half text-teal-600 animate-pulse"></i>
                        <span id="timer" class="font-mono font-bold text-lg text-slate-700">15:00</span>
                    </div>
                </div>
                <div id="progress-container" class="w-48 flex gap-1 hidden">
                    <div id="step-1" class="progress-step active rounded-l-full"></div>
                    <div id="step-2" class="progress-step inactive"></div>
                    <div id="step-3" class="progress-step inactive rounded-r-full"></div>
                </div>
            </div>
        </header>

        <!-- STAGE 0: LOGIN -->
        <section id="login-stage" class="game-card p-12 md:p-20 animate-up text-center max-w-xl mx-auto">
            <div class="relative w-28 h-28 mx-auto mb-8">
                <div class="absolute inset-0 bg-teal-100 rounded-full animate-ping opacity-25"></div>
                <div class="relative w-28 h-28 bg-teal-50 rounded-full flex items-center justify-center shadow-inner">
                    <i class="fa-solid fa-user-secret text-6xl text-teal-600"></i>
                </div>
            </div>
            <h2 class="text-3xl font-bold mb-4 heading tracking-tight text-slate-900">Access Restricted</h2>
            <p class="text-slate-500 mb-10 text-lg leading-relaxed">Agent, two high-profile CME cases are under investigation for potentially fraudulent outcomes storytelling. Your expertise is required to separate perception from impact.</p>
            
            <div class="space-y-4">
                <input type="text" id="name-input" placeholder="Enter Agent Name" class="w-full p-5 border-2 border-slate-100 rounded-2xl focus:border-teal-500 focus:ring-4 focus:ring-teal-50 outline-none text-center text-xl font-medium shadow-sm transition-all mb-4">
                <button onclick="beginInvestigation()" class="w-full btn-teal py-5 rounded-2xl font-bold uppercase tracking-widest text-sm transition-all shadow-2xl">Initialize Mission</button>
            </div>
        </section>

        <!-- STAGE 1: CASE FILE A -->
        <section id="case1-stage" class="stage-hidden animate-up space-y-8">
            <div class="grid lg:grid-cols-12 gap-10">
                <div class="lg:col-span-7 space-y-8">
                    <div class="game-card p-10 border-l-[12px] border-l-teal-600 relative overflow-hidden">
                        <div class="flex items-center justify-between mb-8">
                            <div class="flex items-center gap-3">
                                <span class="bg-teal-100 text-teal-700 text-[10px] font-black px-4 py-1.5 rounded-full uppercase tracking-widest">Case A</span>
                                <h3 class="font-extrabold heading text-3xl">"The Program Everyone Loved"</h3>
                            </div>
                            <i class="fa-solid fa-file-circle-exclamation text-slate-200 text-4xl"></i>
                        </div>

                        <div class="prose prose-slate mb-10">
                            <p class="text-slate-600 leading-relaxed text-lg italic">
                                Summary: A CME activity focused on clinical decision-making reports very strong success and is being highlighted internally as a model program. Is it actually successful?
                            </p>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-6 mb-12">
                            <div class="bg-slate-50 p-6 rounded-3xl border-2 border-slate-100 text-center shadow-sm">
                                <span class="block text-[10px] font-bold text-slate-400 uppercase mb-2">Learner Satisfaction</span>
                                <span class="text-3xl font-black text-teal-600">94%</span>
                                <div class="w-full bg-slate-200 h-1.5 mt-3 rounded-full overflow-hidden">
                                    <div class="bg-teal-500 h-full" style="width: 94%"></div>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-3xl border-2 border-slate-100 text-center shadow-sm">
                                <span class="block text-[10px] font-bold text-slate-400 uppercase mb-2">Knowledge Gain</span>
                                <span class="text-3xl font-black text-teal-600">+38%</span>
                                <div class="w-full bg-slate-200 h-1.5 mt-3 rounded-full overflow-hidden">
                                    <div class="bg-teal-500 h-full" style="width: 75%"></div>
                                </div>
                            </div>
                            <div class="bg-slate-50 p-6 rounded-3xl border-2 border-slate-100 text-center shadow-sm">
                                <span class="block text-[10px] font-bold text-slate-400 uppercase mb-2">Confidence Score</span>
                                <span class="text-3xl font-black text-teal-600">4.8/5</span>
                                <div class="w-full bg-slate-200 h-1.5 mt-3 rounded-full overflow-hidden">
                                    <div class="bg-teal-500 h-full" style="width: 96%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            <h4 class="text-xs font-black uppercase text-slate-400 tracking-[0.2em] flex items-center gap-2 mb-6">
                                <i class="fa-solid fa-comments text-teal-600"></i> Field Intelligence (Click to Listen)
                            </h4>
                            <div class="npc-chat" onclick="interrogate('Sarah (Program Manager)', 'This program was flawless. We had world-class faculty, and the 94% satisfaction proves it. Stakeholders are thrilled with the knowledge gains.')">
                                <span class="text-xs font-black text-teal-600 uppercase block mb-1">Sarah, Program Manager:</span>
                                <p class="text-sm italic text-slate-700">"This program was flawless... proof of value..."</p>
                            </div>
                            <div class="npc-chat" onclick="interrogate('Dr. Miller (Participant)', 'It was interesting, but I haven\'t changed anything in my actual clinical practice because the workflow doesn\'t allow it. Theory was nice, though.')">
                                <span class="text-xs font-black text-slate-700 uppercase block mb-1">Dr. Miller, Participant:</span>
                                <p class="text-sm italic text-slate-700">"Interesting, but I haven't changed anything..."</p>
                            </div>
                            <div class="npc-chat" onclick="interrogate('James (Data Analyst)', 'We didn\'t track behavior post-activity. We are reporting perception, not performance. We don\'t know if they applied it.')">
                                <span class="text-xs font-black text-slate-400 uppercase block mb-1">James, Data Analyst:</span>
                                <p class="text-sm italic text-slate-700">"Reporting perception, not performance..."</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-5 space-y-6">
                    <div class="game-card p-10 bg-slate-900 text-white shadow-2xl border-none">
                        <div class="flex items-center gap-3 mb-10">
                            <i class="fa-solid fa-clipboard-check text-teal-400 text-2xl"></i>
                            <h3 class="font-extrabold heading text-2xl tracking-tight">Agent Deduction</h3>
                        </div>
                        <div class="space-y-8">
                            <div>
                                <label class="text-[10px] font-black uppercase text-teal-400 block mb-3 tracking-widest">Initial Insight (What the data suggests)</label>
                                <textarea id="c1-insight" class="w-full bg-slate-800 border-2 border-slate-700 rounded-2xl p-4 text-sm h-24 outline-none focus:border-teal-400 text-slate-200 shadow-inner" placeholder="e.g. Participants were happy..."></textarea>
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-teal-400 block mb-3 tracking-widest">Action (What happened in reality)</label>
                                <textarea id="c1-action" class="w-full bg-slate-800 border-2 border-slate-700 rounded-2xl p-4 text-sm h-24 outline-none focus:border-teal-400 text-slate-200 shadow-inner" placeholder="e.g. They learned theory but didn't apply it..."></textarea>
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-teal-400 block mb-3 tracking-widest">Outcome (The Truthful Claim)</label>
                                <textarea id="c1-outcome" class="w-full bg-slate-800 border-2 border-slate-700 rounded-2xl p-4 text-sm h-24 outline-none focus:border-teal-500 text-slate-200 shadow-inner" placeholder="How would you responsibly report this?"></textarea>
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-teal-400 block mb-3 tracking-widest">Investigation Gap (What's missing?)</label>
                                <textarea id="c1-next" class="w-full bg-slate-800 border-2 border-slate-700 rounded-2xl p-4 text-sm h-24 outline-none focus:border-teal-500 text-slate-200 shadow-inner" placeholder="e.g. Follow-up behavioral data..."></textarea>
                            </div>
                        </div>
                        <button onclick="completeCase1()" class="w-full mt-12 bg-teal-500 text-slate-900 font-black py-6 rounded-2xl text-xs uppercase tracking-[0.3em] hover:bg-white transition-all shadow-2xl">File Case A</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- STAGE 2: CASE FILE B -->
        <section id="case2-stage" class="stage-hidden animate-up space-y-8">
            <div class="grid lg:grid-cols-12 gap-10">
                <div class="lg:col-span-7 space-y-8">
                    <div class="game-card p-10 border-l-[12px] border-l-indigo-600 relative overflow-hidden">
                        <div class="flex items-center justify-between mb-8">
                            <div class="flex items-center gap-3">
                                <span class="bg-indigo-100 text-indigo-700 text-[10px] font-black px-4 py-1.5 rounded-full uppercase tracking-widest">Case B</span>
                                <h3 class="font-extrabold heading text-3xl">"The Too-Good Outcome"</h3>
                            </div>
                            <i class="fa-solid fa-chart-line text-slate-200 text-4xl"></i>
                        </div>

                        <div class="prose prose-slate mb-10">
                            <p class="text-slate-600 leading-relaxed text-lg italic">
                                Summary: A multi-session initiative reports improved patient outcomes. Leadership wants to highlight this. But hospitalizations dropped (14% → 9%) at the exact same time a new clinical protocol was launched.
                            </p>
                        </div>
                        
                        <div class="bg-indigo-50 p-8 rounded-3xl border-2 border-indigo-100 mb-10 shadow-inner">
                            <h4 class="font-black text-[10px] uppercase text-indigo-700 mb-6 tracking-[0.3em] text-center">Intelligence intercepts</h4>
                            <div class="space-y-4 text-xs">
                                <div class="bg-white p-4 rounded-xl border italic">"The new protocol changed everything. The education helped us understand it, but the protocol made the drop happen." - Clinical Lead</div>
                                <div class="bg-white p-4 rounded-xl border italic">"We only have data for 63 of 420 learners. It's a tiny sample size for such a huge claim." - Analyst</div>
                            </div>
                        </div>

                        <h4 class="text-[11px] font-black uppercase text-slate-400 mb-6 tracking-[0.4em] text-center">Outcome Attribution (Drag & Drop)</h4>
                        <div class="grid grid-cols-3 gap-6 mb-10">
                            <div class="space-y-3">
                                <h5 class="text-[9px] font-black uppercase text-center text-teal-600">Education Contributed</h5>
                                <div id="bin-likely" ondrop="drop(event)" ondragover="allowDrop(event)" class="drop-zone border-teal-200"></div>
                            </div>
                            <div class="space-y-3">
                                <h5 class="text-[9px] font-black uppercase text-center text-indigo-600">May Have Aided</h5>
                                <div id="bin-maybe" ondrop="drop(event)" ondragover="allowDrop(event)" class="drop-zone border-indigo-200"></div>
                            </div>
                            <div class="space-y-3">
                                <h5 class="text-[9px] font-black uppercase text-center text-rose-600">Cannot Be Credited</h5>
                                <div id="bin-no" ondrop="drop(event)" ondragover="allowDrop(event)" class="drop-zone border-rose-200"></div>
                            </div>
                        </div>
                        
                        <div id="pool" class="flex flex-wrap gap-3 p-6 bg-slate-100 rounded-3xl">
                            <div id="e1" draggable="true" ondragstart="drag(event)" class="evidence-token">5% Regional Hospitalization Drop</div>
                            <div id="e2" draggable="true" ondragstart="drag(event)" class="evidence-token">New Clinical Protocol Launch</div>
                            <div id="e3" draggable="true" ondragstart="drag(event)" class="evidence-token">Follow-up from 63/420 learners</div>
                            <div id="e4" draggable="true" ondragstart="drag(event)" class="evidence-token">Learner self-reported protocol alignment</div>
                        </div>
                    </div>
                </div>

                <div class="lg:col-span-5 space-y-6">
                    <div class="game-card p-10 bg-slate-900 text-white shadow-2xl border-none">
                        <div class="flex items-center gap-3 mb-10">
                            <i class="fa-solid fa-pen-nib text-teal-400 text-2xl"></i>
                            <h3 class="font-extrabold heading text-2xl tracking-tight text-teal-400">Final Debrief</h3>
                        </div>
                        <p class="text-[11px] text-slate-400 mb-10 leading-relaxed italic">Write a responsible outcome statement for Case B using the framework: **Insight &rarr; Action &rarr; Outcome**.</p>
                        
                        <div class="space-y-8">
                            <div>
                                <label class="text-[10px] font-black uppercase text-teal-400 block mb-3 tracking-widest">Insight & Action</label>
                                <textarea id="cB-action" class="w-full bg-slate-800 border-2 border-slate-700 rounded-2xl p-4 text-sm h-32 outline-none focus:border-teal-500 text-slate-200" placeholder="e.g. Participants used education to adopt the new protocol..."></textarea>
                            </div>
                            <div>
                                <label class="text-[10px] font-black uppercase text-teal-400 block mb-3 tracking-widest">Defensible Outcome</label>
                                <textarea id="cB-outcome" class="w-full bg-slate-800 border-2 border-slate-700 rounded-2xl p-4 text-sm h-32 outline-none focus:border-teal-500 text-slate-200" placeholder="e.g. Supported standard adoption, while other factors contributed to drops..."></textarea>
                            </div>
                        </div>
                        <button onclick="finishInvestigation()" class="w-full mt-12 bg-teal-500 text-slate-900 font-black py-6 rounded-2xl text-xs uppercase tracking-[0.3em] hover:bg-white transition-all shadow-2xl">Close File B</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- STAGE 3: CONCLUSION -->
        <section id="conclusion-stage" class="stage-hidden text-center animate-up max-w-3xl mx-auto py-12">
            <div class="game-card p-16 shadow-2xl border-t-8 border-t-teal-600">
                <div class="relative w-28 h-28 mx-auto mb-10">
                    <div class="relative w-28 h-28 bg-teal-600 rounded-full flex items-center justify-center shadow-2xl">
                        <i class="fa-solid fa-check-double text-4xl text-white"></i>
                    </div>
                </div>
                <h2 class="text-4xl font-extrabold heading mb-6 text-slate-900">Mission Complete</h2>
                <div id="summary-area" class="text-left space-y-10 border-y py-12 my-10 text-slate-600"></div>
                <div class="p-10 bg-slate-900 text-white rounded-[2rem] text-lg serif italic shadow-2xl">
                    "Numbers mislead unless woven into a narrative of Insight → Action → Outcome. You've learned to separate perception from impact."
                </div>
                <div class="mt-14">
                    <button onclick="location.reload()" class="text-teal-600 font-black uppercase text-[11px] tracking-[0.5em] hover:underline">Restart Simulation</button>
                </div>
            </div>
        </section>
    </div>

    <!-- NPC MODAL -->
    <div id="npc-modal" class="fixed inset-0 bg-slate-900/90 backdrop-blur-md flex items-center justify-center z-50 hidden" onclick="closeModal()">
        <div class="bg-white p-12 rounded-[3rem] max-w-md w-full animate-up" onclick="event.stopPropagation()">
            <h4 id="npc-name" class="font-black text-slate-900 uppercase text-xs tracking-widest mb-4">Interrogation File</h4>
            <p id="npc-text" class="text-slate-700 italic text-xl leading-relaxed serif border-l-4 border-teal-600 pl-6 py-2"></p>
            <button onclick="closeModal()" class="w-full mt-10 bg-slate-900 text-white py-5 rounded-2xl font-bold text-xs uppercase tracking-widest">End Interrogation</button>
        </div>
    </div>

    <script>
        let agentName = "";
        let seconds = 900; 
        let timerId;

        function beginInvestigation() {
            agentName = document.getElementById('name-input').value.trim();
            if(!agentName) { alert("Agency Protocols require an Agent Name."); return; }
            document.getElementById('login-stage').classList.add('stage-hidden');
            document.getElementById('case1-stage').classList.remove('stage-hidden');
            document.getElementById('status-text').innerText = "Analyzing: Case File A";
            document.getElementById('session-timer').classList.remove('hidden');
            document.getElementById('progress-container').classList.remove('hidden');
            startTimer();
        }

        function startTimer() {
            timerId = setInterval(() => {
                if(seconds > 0) {
                    seconds--;
                    const m = Math.floor(seconds/60);
                    const s = seconds % 60;
                    document.getElementById('timer').innerText = `${m}:${s < 10 ? '0' : ''}${s}`;
                }
            }, 1000);
        }

        function interrogate(name, text) {
            document.getElementById('npc-name').innerText = name;
            document.getElementById('npc-text').innerText = `"${text}"`;
            document.getElementById('npc-modal').classList.remove('hidden');
        }

        function closeModal() { document.getElementById('npc-modal').classList.add('hidden'); }

        function completeCase1() {
            const inputs = ['c1-insight', 'c1-action', 'c1-outcome', 'c1-next'];
            if(inputs.some(id => !document.getElementById(id).value.trim())) {
                alert("The Agency requires a full report.");
                return;
            }
            document.getElementById('case1-stage').classList.add('stage-hidden');
            document.getElementById('case2-stage').classList.remove('stage-hidden');
            document.getElementById('status-text').innerText = "Analyzing: Case File B";
            document.getElementById('step-2').classList.replace('inactive', 'active');
            window.scrollTo({top: 0, behavior: 'smooth'});
        }

        function allowDrop(ev) { ev.preventDefault(); ev.currentTarget.classList.add('active'); }
        function drag(ev) { ev.dataTransfer.setData("text", ev.target.id); }
        function drop(ev) {
            ev.preventDefault();
            ev.currentTarget.classList.remove('active');
            var data = ev.dataTransfer.getData("text");
            var card = document.getElementById(data);
            ev.currentTarget.appendChild(card);
            card.style.width = "100%";
        }

        function finishInvestigation() {
            const finalOut = document.getElementById('cB-outcome').value.trim();
            if(!finalOut) { alert("Finalize the outcome statement first."); return; }
            clearInterval(timerId);
            document.getElementById('case2-stage').classList.add('stage-hidden');
            document.getElementById('conclusion-stage').classList.remove('stage-hidden');
            document.getElementById('status-text').innerText = "Status: Successful Prosecution";
            document.getElementById('step-3').classList.replace('inactive', 'active');
            document.getElementById('summary-area').innerHTML = `
                <p>Agent <span class="font-bold text-slate-900">${agentName}</span>, your investigation confirms the critical skill of **Outcome Skepticism**.</p>
                <div class="bg-indigo-50 p-8 rounded-2xl border-2 border-indigo-100 italic text-lg serif">"${finalOut}"</div>
            `;
            window.scrollTo({top: 0, behavior: 'smooth'});
        }
    </script>
</body>
</html>
